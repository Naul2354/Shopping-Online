name: CI/CD for Shopping Online

on:
  push:
    branches:
      - main  # Change this to your main branch name

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: "‚òÅÔ∏è Checkout code "
      uses: actions/checkout@v2

    - name: "üîß Setup Node.js"
      uses: actions/setup-node@v2
      with:
        node-version: '18.x'  # Adjust the Node.js version as needed

    - name: "üì¶ Install dependencies and build"
      run: |
        cd server
        npm install
        (cd client-admin && npm install && npm run build && cp -r build ../server/combined-build)
        (cd client-customer && npm install && npm run build && cp -r build ../server/combined-build)

  deploy:
    needs: build
    runs-on: ubuntu-latest

    steps:
    - name: Upload artifact
      uses: actions/upload-artifact@v2
      with:
        name: website-artifact
        path: server/combined-build  # Adjust the path to your combined build output directory

    # - name: Deploy to Azure Static Web Apps
    #   uses: Azure/static-web-apps-deploy@v1
    #   with:
    #     azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
    #     repo_token: ${{ secrets.GITHUB_TOKEN }}
    #     action: "upload"
    #     app_location: "server/combined-build"  # Adjust the path to your combined build output directory
    #     api_location: "server/api"  # Specify the path to your API
    #     app_artifact_location: "website-artifact"  # The name you specified in the upload-artifact step
    #     output_location: ""  # Leave empty for default output location
